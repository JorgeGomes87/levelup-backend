<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>LevelUp Backend - Demo</title>

  <style>
    body {
      margin: 0;
      font-family: Arial, Helvetica, sans-serif;
      background: #0f172a;
      color: #e5e7eb;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .container {
      background: #020617;
      padding: 30px;
      border-radius: 10px;
      width: 420px;
      box-shadow: 0 0 20px rgba(0,0,0,0.6);
    }

    h1 {
      text-align: center;
      margin-bottom: 20px;
      color: #38bdf8;
    }

    h2 {
      margin-top: 25px;
      font-size: 18px;
      color: #94a3b8;
    }

    input {
      width: 100%;
      padding: 10px;
      margin-top: 8px;
      margin-bottom: 12px;
      border: none;
      border-radius: 5px;
      background: #020617;
      color: #fff;
      border: 1px solid #1e293b;
    }

    button {
      width: 100%;
      padding: 10px;
      background: #38bdf8;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      color: #020617;
      transition: 0.2s;
    }

    button:hover {
      background: #0ea5e9;
    }

    .success {
      color: #22c55e;
      margin-top: 10px;
    }

    .error {
      color: #ef4444;
      margin-top: 10px;
    }

    ul {
      margin-top: 10px;
      padding-left: 20px;
    }

    .hidden {
      display: none;
    }

    .status {
      text-align: center;
      font-size: 12px;
      margin-bottom: 15px;
      color: #94a3b8;
    }
  </style>
</head>

<body>

<div class="container">

  <h1>üöÄ LevelUp Backend</h1>

  <div class="status" id="apiStatus">üîÑ Verificando API...</div>

  <!-- CADASTRO -->
  <h2>Cadastro</h2>
  <input id="cadNome" placeholder="Nome">
  <input id="cadEmail" placeholder="Email">
  <input id="cadSenha" type="password" placeholder="Senha">
  <button onclick="cadastrar()">Cadastrar</button>
  <div id="cadMsg"></div>

  <!-- LOGIN -->
  <h2>Login</h2>
  <input id="loginEmail" placeholder="Email">
  <input id="loginSenha" type="password" placeholder="Senha">
  <button onclick="login()">Entrar</button>
  <div id="loginMsg"></div>

  <!-- A√á√ïES P√ìS LOGIN -->
  <div id="areaLogada" class="hidden">
    <h2>Ranking</h2>
    <button onclick="carregarRanking()">Carregar Ranking</button>
    <ul id="ranking"></ul>

    <button style="margin-top:15px;background:#ef4444;color:white" onclick="logout()">Logout</button>
  </div>

</div>

<script>
  const API = 'http://localhost:3000';

  // ==============================
  // STATUS DA API
  // ==============================
  fetch(API)
    .then(() => {
      document.getElementById('apiStatus').innerText = 'üü¢ API Online';
    })
    .catch(() => {
      document.getElementById('apiStatus').innerText = 'üî¥ API Offline';
    });

  // ==============================
  // CADASTRO
  // ==============================
  async function cadastrar() {
    const nome = cadNome.value;
    const email = cadEmail.value;
    const senha = cadSenha.value;

    try {
      const res = await fetch(`${API}/usuarios/cadastro`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ nome, email, senha })
      });

      const data = await res.json();
      console.log('Cadastro:', data);

     cadMsg.innerHTML = res.ok
  ? `<div class="success">‚úÖ ${data.message || 'Usu√°rio cadastrado com sucesso!'}</div>`
  : `<div class="error">‚ùå ${data.error || 'Erro no cadastro'}</div>`;


    } catch (err) {
      cadMsg.innerHTML = `<div class="error">Erro ao conectar com a API</div>`;
    }
  }

  // ==============================
  // LOGIN
  // ==============================
  async function login() {
    const email = loginEmail.value;
    const senha = loginSenha.value;

    try {
      const res = await fetch(`${API}/usuarios/login`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, senha })
      });

      const data = await res.json();
      console.log('Login:', data);

      if (res.ok) {
        localStorage.setItem('token', data.token);
        loginMsg.innerHTML = `<div class="success">‚úÖ Login realizado</div>`;
        document.getElementById('areaLogada').classList.remove('hidden');
      } else {
        
      }

    } catch (err) {
      loginMsg.innerHTML = `<div class="error">Erro ao conectar com a API</div>`;
    }
  }

  // ==============================
  // RANKING
  // ==============================
  async function carregarRanking() {
    const token = localStorage.getItem('token');
    ranking.innerHTML = '';

    try {
      const res = await fetch(`${API}/usuarios/ranking`, {
        headers: {
          Authorization: `Bearer ${token}`
        }
      });

loginMsg.innerHTML = `<div class="error">‚ùå ${data.error || 'Erro no login'}</div>`;
        const data = await res.json();

      data.forEach(user => {
        const li = document.createElement('li');
        li.textContent = `${user.nome} - ${user.pontos || 0} pts`;
        ranking.appendChild(li);
      });

    } catch (err) {
      ranking.innerHTML = `<li>Erro ao carregar ranking</li>`;
    }
  }

  // ==============================
  // LOGOUT
  // ==============================
  function logout() {
    localStorage.removeItem('token');
    document.getElementById('areaLogada').classList.add('hidden');
    loginMsg.innerHTML = '';
    alert('Logout realizado');
  }

</script>

</body>
</html>
